/*drop table SystemParameters;
drop table SubService;
drop table Reservation;
drop table Service;
drop table Payment;
drop table Principal;
alter table object drop Constraint "OBJECT_TYPEIDTOTYPE_ID"
drop table Type;
drop table object;*/

CREATE Table Object
(
    ID BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    InternalName    VARCHAR(255),
    TypeID          BIGINT    NOT NULL,
    IsDeleted       INTEGER,
    CreatedDate     DATE,
    CreatedBy       BIGINT,
    DeletedDate     DATE,
    DeletedBy       BIGINT,
    OPT_LOCK_VERSION INTEGER,
    PRIMARY KEY (ID)
);

CREATE TABLE Type
(
    ID BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    ObjectID        BIGINT          NOT NULL,
    Title           VARCHAR(255)    NOT NULL,
    Description     VARCHAR(255),
    OPT_LOCK_VERSION INTEGER,
    FOREIGN KEY (ObjectID) REFERENCES Object (ID),
    PRIMARY KEY (ID)
);

CREATE TABLE Principal
(
    ID BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    ObjectID        BIGINT          NOT NULL,
    Username        VARCHAR(255)    NOT NULL,
    Password        VARCHAR(255)    NOT NULL,
    Role            VARCHAR(255)    NOT NULL,
    Priority        INTEGER         NOT NULL,
    Points          DECIMAL         NOT NULL,
    FacebookID      BIGINT,
    FirstName       VARCHAR(255),
    MiddleName      VARCHAR(255),
    LastName        VARCHAR(255),
    Address         VARCHAR(255),
    MembershipDue   DATE            NOT NULL,
    OPT_LOCK_VERSION INTEGER,
    FOREIGN KEY (ObjectID) REFERENCES Object (ID),
    PRIMARY KEY (ID)
);

CREATE TABLE Payment
(
    ID BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    ObjectID            BIGINT          NOT NULL,
    PrincipalID         BIGINT          NOT NULL,
    PrincipalVersionID  BIGINT          NOT NULL,
    PaymentPrice        DECIMAL         NOT NULL,
    PaymentDate         Date            NOT NULL,
    PaidWithMoney       INTEGER         NOT NULL,
    OPT_LOCK_VERSION INTEGER,
    FOREIGN KEY (ObjectID) REFERENCES Object (ID),
    FOREIGN KEY (PrincipalID) REFERENCES Object (ID),
    FOREIGN KEY (PrincipalVersionID) REFERENCES Principal (ID),
    PRIMARY KEY (ID)
);

CREATE TABLE Service
(
    ID BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    ObjectID        BIGINT         NOT NULL,
    IsActive        INTEGER        NOT NULL,
    StartDate       Date           NOT NULL,
    EndDate         Date           NOT NULL,
    WeekPrice       Decimal        NOT NULL,
    Places          INTEGER,
    OPT_LOCK_VERSION INTEGER,
    FOREIGN KEY (ObjectID)  REFERENCES Object (ID),
    PRIMARY KEY (ID)
);

CREATE TABLE Reservation
(
    ID BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    ObjectID            BIGINT          NOT NULL,
    ServiceID           BIGINT          NOT NULL,
    ServiceVersionID    BIGINT          NOT NULL,
    PrincipalID         BIGINT          NOT NULL,
    PrincipalVersionID  BIGINT          NOT NULL,
    StartDate           Date            NOT NULL,
    EndDate             Date            NOT NULL,
    OPT_LOCK_VERSION INTEGER,
    FOREIGN KEY (ObjectID) REFERENCES Object (ID),
    FOREIGN KEY (ServiceID) REFERENCES Object (ID),
    FOREIGN KEY (PrincipalID) REFERENCES Object (ID),
    FOREIGN KEY (ServiceVersionID) REFERENCES Service (ID),
    FOREIGN KEY (PrincipalVersionID) REFERENCES Principal (ID),
    PRIMARY KEY (ID)
);

CREATE TABLE SubService
(
    ID BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    ObjectID         BIGINT         NOT NULL,
    ParentID         BIGINT         NOT NULL,
    ParentVersionID         BIGINT         NOT NULL,
    ChildID          BIGINT         NOT NULL,
    ChildVersionID         BIGINT         NOT NULL,
    OPT_LOCK_VERSION INTEGER,
    FOREIGN KEY (ObjectID)  REFERENCES Object (ID),
    FOREIGN KEY (ParentID)  REFERENCES Object (ID),
    FOREIGN KEY (ChildID)   REFERENCES Object (ID),
    FOREIGN KEY (ParentVersionID)  REFERENCES Service (ID),
    FOREIGN KEY (ChildVersionID)   REFERENCES Service (ID),
    PRIMARY KEY (ID)
);

CREATE TABLE SystemParameters
(
    ID BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    ObjectID        BIGINT          NOT NULL, 
    Title           VARCHAR(255)    NOT NULL,
    Description     VARCHAR(255),
    Value           INT             NOT NULL,
    OPT_LOCK_VERSION INTEGER,
    FOREIGN KEY (ObjectID)  REFERENCES Object (ID),
    PRIMARY KEY (ID)
);

ALTER TABLE Object ADD CONSTRAINT Object_TypeIDToType_ID  FOREIGN KEY (TypeID) REFERENCES Type (ID);